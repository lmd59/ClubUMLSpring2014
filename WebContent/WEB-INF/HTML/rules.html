<!DOCTYPE html>
<html>
<head>
    <title>Rules</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>
<body>
<div class="container-fluid">
<div class="row-fluid">
    <div class="span12">
        <h5 class="text-center">
            Please set your requirements for the use case diagram
        </h5>
    </div>
</div>

<div class="row-fluid">
    <!-- Actors -->
    <div class="span6">
        <fieldset>
            <legend>Actors</legend>
            <div class="row-fluid">
                <div class="span12">
                    <p><a href="#actModal" onclick="initActModal()" role="button" class="btn btn-primary" data-toggle="modal">Add Actor</a></p>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <table id="actTable" class="table table-bordered table-hover text-center">
                        <tr>
                            <th style="text-align: center">Actor Name</span></th>
                            <th style="text-align: center">Max Number of Use Cases</th>
                            <th style="text-align: center">Operations</th>

                        </tr>
                        <tr>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">3</td>
                            <td style="text-align: center">
                                <a href="#actModal" itemIndex itemType title="Edit"><i class="icon-pencil"></i></a>
                                <a href="#delModal" itemIndex itemType title="Delete"><i class="icon-trash"></i></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </fieldset>
    </div>
    <!-- Use Cases -->
    <div class="span6">
        <fieldset>
            <legend>Use Cases</legend>
            <div class="row-fluid">
                <div class="span12">
                    <p><a href="#ucModal" role="button" class="btn btn-primary" data-toggle="modal" onclick='initUcModal()'>Add Use Case</a></p>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <table id="ucTable" class="table table-bordered table-hover text-center">
                        <tr>
                            <th style="text-align: center">Use Case Name</th>
                            <th style="text-align: center">Max Number of Actors</th>
                            <th style="text-align: center">Operations</th>
                        </tr >
                        <tr>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">3</td>
                            <td style="text-align: center">
                                <a href="#" title="Edit"><i class="icon-pencil"></i></a>
                                <a href="#" title="Delete"><i class="icon-trash"></i></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </fieldset>
    </div>
</div>
<br/>
<!--Must-have associations-->
<div class="row-fluid">
    <div class="span6">
        <fieldset>
            <legend>Must-have Associations</legend>
            <div class="row-fluid">
                <div class="span12">
                    <p><a href="#assModal" role="button" class="btn btn-primary" data-toggle="modal" onclick="initAssModal(undefined,TYPE_MUST_HAVE_ASSOCIATION)">Add Association</a></p>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <table id="mhaTable" class="table table-bordered table-hover text-center">
                        <tr>
                            <th style="text-align: center">Actor Name</span></th>
                            <th style="text-align: center">Use Case Name</th>
                            <th style="text-align: center">Operations</th>
                        </tr >
                        <tr>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">test use case</td>
                            <td style="text-align: center">
                                <a href="#" title="Edit"><i class="icon-pencil"></i></a>
                                <a href="#" title="Delete"><i class="icon-trash"></i></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </fieldset>
    </div>
    <!-- Must-not-have Associations -->
    <div class="span6">
        <fieldset>
            <legend>Must-not-have Associations</legend>
            <div class="row-fluid">
                <div class="span12">
                    <p><a href="#assModal" role="button" class="btn btn-primary" onclick="initAssModal(undefined,TYPE_MUST_NOT_HAVE_ASSOCIATION)" data-toggle="modal">Add Association</a></p>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <table id="mnaTable" class="table table-bordered table-hover text-center">
                        <tr>
                            <th style="text-align: center">Actor Name</th>
                            <th style="text-align: center">Use Case Name</th>
                            <th style="text-align: center">Operations</th>
                        </tr >
                        <tr>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">Test use case</td>
                            <td style="text-align: center">
                                <a href="#" title="Edit"><i class="icon-pencil"></i></a>
                                <a href="#" title="Delete"><i class="icon-trash"></i></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </fieldset>
    </div>
</div>
<!-- Must-have inclusion/extension -->
<div class="row-fluid">
    <div class="span6">
        <fieldset>
            <legend>Must-have Inclusions/Extensions</legend>
            <div class="row-fluid">
                <div class="span12">
                    <p><a href="#ieModal" role="button" class="btn btn-primary" onclick="initIoEModal(undefined,TYPE_MUST_HAVE_IoE)" data-toggle="modal">Add Inclusion/Extension</a></p>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <table id="mhiTable" class="table table-bordered table-hover text-center">
                        <tr>
                            <th style="text-align: center">Use Case 1</span></th>
                            <th style="text-align: center">Relationship</th>
                            <th style="text-align: center">Use Case 2</span></th>
                            <th style="text-align: center">Operations</th>
                        </tr >
                        <tr>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">includes</td>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">
                                <a href="#" title="Edit"><i class="icon-pencil"></i></a>
                                <a href="#" title="Delete"><i class="icon-trash"></i></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </fieldset>
    </div>
    <!-- Must-not-have inclusion/extension -->
    <div class="span6">
        <fieldset>
            <legend>Must-not-have Inclusions/Extensions</legend>
            <div class="row-fluid">
                <div class="span12">
                    <p><a href="#ieModal" role="button" class="btn btn-primary" onclick="initIoEModal(undefined,TYPE_MUST_NOT_HAVE_IoE)" data-toggle="modal">Add Inclusion/Extension</a></p>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <table id="mniTable" class="table table-bordered table-hover text-center">
                        <tr>
                            <th style="text-align: center">Use Case 1</span></th>
                            <th style="text-align: center">Relationship</th>
                            <th style="text-align: center">Use Case 2</span></th>
                            <th style="text-align: center">Operations</th>
                        </tr >
                        <tr>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">includes</td>
                            <td style="text-align: center">test name</td>
                            <td style="text-align: center">
                                <a href="#" title="Edit"><i class="icon-pencil"></i></a>
                                <a href="#" title="Delete"><i class="icon-trash"></i></a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </fieldset>
    </div>
</div>
<div class="row-fluid">
    <div class="span6">
        <a class="btn btn-primary offset10" href=# onclick="submitRules()">Submit</a>
    </div>
    <div class="span6">
        <a class="btn offset1" href=#>Cancel</a>
    </div>
</div>
</div>
<!-- Actor Modal -->
<div id="actModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h3>Actor Infomation</h3>
    </div>
    <div class="modal-body">
        <form id="actForm" class="form-horizontal">
            <div id="actNameGroup" class="control-group">
                <label class="control-label" for="actName">Actor Name</label>
                <div class="controls">
                    <input type="text" id="actName">
                </div>
            </div>
            <div id="maxUcNumGroup" class="control-group">
                <label class="control-label" for="maxUcNum">Max Number of Use Cases </label>
                <div class="controls">
                    <input type="text" id="maxUcNum">
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <a href="#" class="btn btn-primary" onclick="addActor()">Add</a>
    </div>
</div>
<!-- Use Case Modal -->
<div id="ucModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h3>Use Case Infomation</h3>
    </div>
    <div class="modal-body">
        <form class="form-horizontal">
            <div id="ucNameGroup" class="control-group">
                <label class="control-label" for="ucName">Use Case Name</label>
                <div class="controls">
                    <input type="text" id="ucName">
                </div>
            </div>
            <div id="maxActNumGroup" class="control-group">
                <label class="control-label" for="maxActNum">Max Number of Actors </label>
                <div class="controls">
                    <input type="text" id="maxActNum">
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <a href="#" onclick='addUseCase()' class="btn btn-primary">Add</a>
    </div>
</div>
<!-- Association Modal -->
<div id="assModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h3 head>Association Infomation</h3>
    </div>
    <div class="modal-body">
        <form class="form-horizontal">
            <div id='actSelGroup' class="control-group">
                <label class="control-label" for="actSel">Actor</label>
                <div class="controls" id="actCtr">

                </div>
            </div>
            <div id='ucSelGroup' class="control-group">
                <label class="control-label" for="ucSel">Use Case</label>
                <div class="controls" id="ucCtr">

                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <a href="#" class="btn btn-primary" onclick="addAss()">Add</a>
    </div>
</div>
<!-- Inclusion/extension Modal -->
<div id="ieModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h3 head>Inclusion/Extension Infomation</h3>
    </div>
    <div class="modal-body">
        <form class="form-horizontal">
            <div class="control-group" id="fromUcSelGroup">
                <label class="control-label" for="fromUcSel">From Use Case</label>
                <div class="controls" id="fromUcCtr">

                </div>
            </div>
            <div class="control-group" id="ieSelGroup">
                <label class="control-label" for="ieSel">Relationship</label>
                <div class="controls" id="ieCtr">
                    <select id="ieSel">
                        <option value="-1">Select Relationship</option>
                        <option value="0">Includes</option>
                        <option value="1">Extends</option>
                    </select>
                </div>
            </div>
            <div class="control-group" id="toUcSelGroup">
                <label class="control-label" for="toUcSel">To Use Case</label>
                <div class="controls" id="toUcCtr">

                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <a href="#" class="btn btn-primary" onclick="addIoE()">Add</a>
    </div>
</div>
<!-- Delete Confirmation Modal -->
<div id="delModal" class="modal hide fade" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h3 id="myModalLabel">Delete Confirmation</h3>
    </div>
    <div class="modal-body">
        <p id="delQues" style="color:red"><b>Are you sure you want to delete this item?</b></p>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">No</button>
        <button class="btn btn-primary" onclick="delItem()">Yes</button>
    </div>
</div>
<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
var TYPE_ACTOR=11;
var TYPE_USE_CASE=21;
var TYPE_MUST_HAVE_ASSOCIATION=31;
var TYPE_MUST_NOT_HAVE_ASSOCIATION=30;
var TYPE_MUST_HAVE_IoE=41; //the type number for must-have Inclusion/Extension
var TYPE_MUST_NOT_HAVE_IoE=40; //the type number for must-not-have Inclusion/Extension

var actArray=new Array();
var ucArray=new Array();
var mustHaveAssArray=new Array();
var mustNotHaveAssArray=new Array();
var mustHaveInArray=new Array();
var mustNotHaveInArray=new Array();
var mustHaveExArray=new Array();
var mustNotHaveExArray=new Array();
function changeModalTitle(id,title) {
    $('#'+id+' h3[head]').text(title);
}

function addActor() {
    var actName=$.trim($('#actName').val());
    var maxUcNum=$('#maxUcNum').val();
    if(actName.length==0||actName.search(/actor/i)==0)
    {
        $('#actNameGroup').addClass('error');
        return false;
    }
    var reg=new RegExp("^[0-9]*[1-9][0-9]*$");
    if(maxUcNum.length!=0&&!reg.test(maxUcNum)){
        $('#maxUcNumGroup').addClass('error');
        return false;
    }
    var itemIndex= $('#actModal').data('itemIndex');
    var actor;
    if(itemIndex!=undefined){
        actor=actArray[itemIndex];
        actor.name=actName;
        actor.maxUcNum=maxUcNum;
        var actRow=$('#actTable').find('tr[itemIndex='+itemIndex+']');
        actRow.find('td[colName=actName]').text(actName);
        actRow.find('td[colName=maxUcNum]').text(maxUcNum);
        $('#actModal').removeData("itemIndex");
    } else {
        actor=
        {
            'name': actName,
            'maxUcNum': maxUcNum
        }
        itemIndex=actArray.push(actor)-1;
        var actRow =$('<tr itemIndex="'+itemIndex+'"> <td style="text-align: center" colName="actName"></td> <td style="text-align: center" colName="maxUcNum"></td> <td style="text-align: center"> <a href="#actModal" role="button" data-toggle="modal" itemIndex itemType title="Edit" onclick="initActModal(this)"><i class="icon-pencil"></i></a> <a href="#delModal" role="button" data-toggle="modal" itemIndex itemType title="Delete" onclick="initDelModal(this)"><i class="icon-trash"></i></a> </td> </tr>');
        actRow.find('tr[itemIndex]').attr('itemIndex',itemIndex);
        actRow.find('td[colName=actName]').text(actName);
        actRow.find('td[colName=maxUcNum]').text(maxUcNum);
        actRow.find('a[itemIndex]').attr('itemIndex',itemIndex);
        actRow.find('a[itemType]').attr('itemType',TYPE_ACTOR);
        actRow.appendTo('#actTable');
    }

    $("#actModal").modal('hide');
}

function initActModal(sender) {
    if(sender===undefined){
        $('#actName').val("");
        $('#maxUcNum').val("");
        $('#actName').removeClass('error');
        $('#maxUcNum').removeClass('error');
    } else {
        var itemIndex=$(sender).attr('itemIndex');
        $('#actModal').data('itemIndex',itemIndex);
        $('#actName').val(actArray[itemIndex].name);
        $('#maxUcNum').val(actArray[itemIndex].maxUcNum);
    }
}

function addAss() {
    var selectedAct=$('#actSel').find('option:selected');

    var selectedUc=$('#ucSel').find('option:selected');
    if(selectedAct.val()==-1) {
        $("#actSelGroup").addClass("error");
        return;
    }
    if(selectedUc.val()==-1) {
        $("#ucSelGroup").addClass("error");
        return;
    }
    var ass;
    var type= $("#assModal").data("type");
    var itemIndex=$('#assModal').data('itemIndex');
    var tableId;
    var sourceArray;
    if(type == TYPE_MUST_HAVE_ASSOCIATION) {
        tableId="#mhaTable";
        sourceArray=mustHaveAssArray;
    }
    if(type== TYPE_MUST_NOT_HAVE_ASSOCIATION){
        tableId="#mnaTable";
        sourceArray=mustNotHaveAssArray;
    }
    var actName = selectedAct.text();
    var ucName = selectedUc.text();
    var actIndex =selectedAct.val();
    var ucIndex=selectedUc.val();
    ass=
    {
        actorName: actName ,
        useCaseName: ucName
    }
    if(itemIndex!=undefined) {
        sourceArray[itemIndex]=ass;
        var assRow=$(tableId).find('tr[itemIndex='+itemIndex+']');
        assRow.find('td[colName=actName]').text(ass.actorName);
        assRow.find('td[colName=ucName]').text(ass.useCaseName);
        $('#assModal').removeData("itemIndex");
    } else {
        itemIndex=sourceArray.push(ass)-1;
        var assRow =$('<tr itemIndex="'+itemIndex+'"> <td style="text-align: center" colName="actName"></td> <td style="text-align: center" colName="ucName"></td> <td style="text-align: center"> <a href="#assModal" role="button" data-toggle="modal" itemIndex itemType actIndex ucIndex title="Edit" onclick="initAssModal(this,undefined)"><i class="icon-pencil"></i></a> <a href="#delModal" role="button" data-toggle="modal" itemIndex itemType title="Delete" onclick="initDelModal(this)"><i class="icon-trash"></i></a> </td> </tr>');
        assRow.find('tr[itemIndex]').attr('itemIndex',itemIndex);
        assRow.find('td[colName=actName]').text(actName);
        assRow.find('td[colName=ucName]').text(ucName);
        assRow.find('a[itemIndex]').attr('itemIndex',itemIndex);
        assRow.find('a[itemType]').attr('itemType',type);
        assRow.find('a[actIndex]').attr('actIndex',actIndex);
        assRow.find('a[ucIndex]').attr('ucIndex',ucIndex);
        assRow.appendTo(tableId);
    }

    $("#assModal").modal('hide');
}


function initAssModal(sender,type) {
    console.log('entered set:'+type);
    if(type==undefined)
    {
        type=$(sender).attr('itemType');
    }
    console.log('after set:'+type);
    if(type==TYPE_MUST_HAVE_ASSOCIATION){
        changeModalTitle("assModal","Must-have Association Information");
    } else if(type==TYPE_MUST_NOT_HAVE_ASSOCIATION) {
        changeModalTitle("assModal","Must-not-have Association Infomation");
    }
    $('#actCtr').empty();
    $('#ucCtr').empty();
    var actSel = getActSel();
    var ucSel= getUcSel("ucSel");
    $('#actCtr').append(actSel);
    $('#ucCtr').append(ucSel);
    $('#assModal').data('type',type);
    $("#actSelGroup").removeClass('error');
    $("#ucSelGroup").removeClass('error');
    if(sender!=undefined) {
        var actIndex=$(sender).attr('actIndex');
        var ucIndex=$(sender).attr('ucIndex');
        actSel.find('option[value=-1]').removeAttr('selected');
        actSel.find('option[value='+actIndex+']').attr('selected','selected');
        ucSel.find('option[value=-1]').removeAttr('selected');
        ucSel.find('option[value='+ucIndex+']').attr('selected','selected');
        var itemIndex= $(sender).attr('itemIndex');
        $('#assModal').data('itemIndex',itemIndex);
    }
}

function initIoEModal(sender,type) {

    if(type==undefined)
    {
        type=$(sender).attr('itemType');
    }

    if(type==TYPE_MUST_HAVE_IoE){
        changeModalTitle("ieModal","Must-have Inclusion/Extension Information");
    } else if(type==TYPE_MUST_NOT_HAVE_IoE) {
        changeModalTitle("ieModal","Must-not-have Inclusion/Extension Infomation");
    }

    $('#fromUcCtr').empty();
    $('#toUcCtr').empty();
    var fromUcSel = getUcSel("fromUcSel");
    var toUcSel= getUcSel("toUcSel");
    $('#fromUcCtr').append(fromUcSel);
    $('#toUcCtr').append(toUcSel);
    $('#ieModal').data('type',type);
    $("#fromUcSelGroup").removeClass('error');
    $("#toUcSelGroup").removeClass('error');
    $("#ieSelGroup").removeClass('error');
    $("#ieSel").find('option[selected=selected]').removeAttr('selected');
    $("#ieSel").find('option[value=-1]').attr('selected','selected');
    if(sender!=undefined) {
        var fromUcIndex=$(sender).attr('fromUcIndex');
        var toUcIndex=$(sender).attr('toUcIndex');
        var relation=$(sender).attr('relation');
        fromUcSel.find('option[value=-1]').removeAttr('selected');
        fromUcSel.find('option[value='+fromUcIndex+']').attr('selected','selected');
        toUcSel.find('option[value=-1]').removeAttr('selected');
        toUcSel.find('option[value='+toUcIndex+']').attr('selected','selected');
        $("#ieSel").find('option[value=-1]').removeAttr('selected');
        $("#ieSel").find('option[value='+relation+']').attr('selected','selected');
        var itemIndex= $(sender).attr('itemIndex');
        console.log('itemIndex in InitIoE:',itemIndex);
        $('#ieModal').data('itemIndex',itemIndex);

    }
}

function addIoE() {
    var selectedFromUc=$('#fromUcSel').find('option:selected');
    var selectedToUc=$('#toUcSel').find('option:selected');
    var selectedIe=$('#ieSel').find('option:selected');
    if(selectedFromUc.val()==-1) {
        $("#fromUcSelGroup").addClass("error");
        return;
    }
    if(selectedToUc.val()==-1) {
        $("#ucSelGroup").addClass("error");
        return;
    }
    if(selectedIe.val()==-1){
        $("#ieSelGroup").addClass("error");
        return;
    }
    var ioe;
    var type= $("#ieModal").data("type");
    console.log('type in add:'+type);
    var itemIndex=$('#ieModal').data('itemIndex');
    var tableId;
    var sourceArray;
    var relation=selectedIe.val();
    if(type == TYPE_MUST_HAVE_IoE) {
        tableId="#mhiTable";
        if(relation==0)
        sourceArray=mustHaveInArray;
        if(relation==1)
        sourceArray=mustHaveExArray;
    }
    if(type== TYPE_MUST_NOT_HAVE_IoE){
        tableId="#mniTable";
        if(relation==0)
            sourceArray=mustNotHaveInArray;
        if(relation==1)
            sourceArray=mustNotHaveExArray;
    }
    var fromUcName = selectedFromUc.text();
    var toUcName = selectedToUc.text();
    var fromUcIndex =selectedFromUc.val();
    var toUcIndex=selectedToUc.val();
    var relationName=selectedIe.text();
    ioe=
    {
        fromUseCaseName: fromUcName ,
        toUseCaseName: toUcName
    }

    if(itemIndex!=undefined) {
        sourceArray[itemIndex]=ioe;
        var ioeRow=$(tableId).find('tr[itemIndex='+itemIndex+']');
        ioeRow.find('td[colName=fromUcName]').text(ioe.fromUseCaseName);
        ioeRow.find('td[colName=toUcName]').text(ioe.toUseCaseName);
        ioeRow.find('td[colName=relation]').text(relationName);
        $('#ieModal').removeData("itemIndex");
    } else {
        itemIndex=sourceArray.push(ioe)-1;
        var ioeRow =$('<tr itemIndex="'+itemIndex+'"> <td style="text-align: center" colName="fromUcName"></td> <td style="text-align: center" colName="relation"></td><td style="text-align: center" colName="toUcName"></td> <td style="text-align: center"> <a href="#ieModal" role="button" data-toggle="modal" itemIndex itemType fromUcIndex toUcIndex relation title="Edit" onclick="initIoEModal(this,undefined)"><i class="icon-pencil"></i></a> <a href="#delModal" role="button" data-toggle="modal" itemIndex itemType title="Delete" onclick="initDelModal(this)"><i class="icon-trash"></i></a> </td> </tr>');
        ioeRow.find('tr[itemIndex]').attr('itemIndex',itemIndex);
        ioeRow.find('td[colName=fromUcName]').text(fromUcName);
        ioeRow.find('td[colName=toUcName]').text(toUcName);
        ioeRow.find('td[colName=relation]').text(relationName);

        ioeRow.find('a[itemIndex]').attr('itemIndex',itemIndex);
        ioeRow.find('a[itemType]').attr('itemType',type);
        ioeRow.find('a[fromUcIndex]').attr('fromUcIndex',fromUcIndex);
        ioeRow.find('a[toUcIndex]').attr('toUcIndex',toUcIndex);
        ioeRow.find('a[relation]').attr('relation',relation);
        ioeRow.appendTo(tableId);
    }

    $("#ieModal").modal('hide');
}

function getActSel(){
    var actSel=$('<select id="actSel"></select>');
    actSel.append("<option value='-1' selected='selected'>Select Actor</option>");
    for(var index=0; index<actArray.length;index++){
        var opt=$('<option value='+index+'>'+actArray[index].name+'</option>');
        actSel.append(opt);
    }
    return actSel;
}
function getUcSel(id){
    var ucSel=$('<select id="'+id+'"></select>');
    ucSel.append("<option value='-1' selected='selected'>Select Use Case</option>");
    for(var index=0; index<ucArray.length;index++){
        var opt=$('<option value='+index+'>'+ucArray[index].name+'</option>');
        ucSel.append(opt);
    }
    return ucSel;
}


function addUseCase() {
    var ucName=$.trim($('#ucName').val());
    var maxActNum=$('#maxActNum').val();
    if(ucName.length==0||ucName.search(/UseCase/i)==0)
    {
        $('#ucNameGroup').addClass('error');
        return false;
    }
    var reg=new RegExp("^[0-9]*[1-9][0-9]*$");
    if(maxActNum.length!=0&&!reg.test(maxActNum)){
        $('#maxActNumGroup').addClass('error');
        return false;
    }
    var itemIndex= $('#ucModal').data('itemIndex');
    var useCase;
    if(itemIndex!=undefined){
        useCase=ucArray[itemIndex];
        useCase.name=ucName;
        useCase.maxActNum=maxActNum;
        var actRow=$('#ucTable').find('tr[itemIndex='+itemIndex+']');
        actRow.find('td[colName=ucName]').text(ucName);
        actRow.find('td[colName=maxActNum]').text(maxActNum);
        $('#ucModal').removeData("itemIndex");
    } else {
        useCase=
        {
            'name': ucName,
            'maxActNum': maxActNum
        }
        itemIndex=ucArray.push(useCase)-1;
        var ucRow =$('<tr itemIndex="'+itemIndex+'"> <td style="text-align: center" colName="ucName"></td> <td style="text-align: center" colName="maxActNum"></td> <td style="text-align: center"> <a href="#ucModal" role="button" data-toggle="modal" itemIndex itemType title="Edit" onclick="initUcModal(this)"><i class="icon-pencil"></i></a> <a href="#delModal" role="button" data-toggle="modal" itemIndex itemType title="Delete" onclick="initDelModal(this)"><i class="icon-trash"></i></a> </td> </tr>');
        ucRow.find('tr[itemIndex]').attr('itemIndex',itemIndex);
        ucRow.find('td[colName=ucName]').text(ucName);
        ucRow.find('td[colName=maxActNum]').text(maxActNum);
        ucRow.find('a[itemIndex]').attr('itemIndex',itemIndex);
        ucRow.find('a[itemType]').attr('itemType',TYPE_USE_CASE);
        ucRow.appendTo('#ucTable');
    }

    $("#ucModal").modal('hide');
}
function initUcModal(sender) {
    if(sender===undefined){
        $('#ucName').val("");
        $('#maxActNum').val("");
        $('#ucName').removeClass('error');
        $('#maxActNum').removeClass('error');
    } else {
        var itemIndex=$(sender).attr('itemIndex');
        $('#ucModal').data('itemIndex',itemIndex);
        $('#ucName').val(actArray[itemIndex].name);
        $('#maxActNum').val(actArray[itemIndex].maxUcNum);
    }
}
function initDelModal(sender) {
    var itemIndex=$(sender).attr('itemIndex');
    $('#delModal').data('itemIndex',itemIndex);
    var itemType=$(sender).attr('itemType');
    $('#delModal').data('itemType',itemType);
}
function delItem(){
    var itemIndex= $('#delModal').data('itemIndex');
    var itemType= $('#delModal').data('itemType');
    if(itemType==TYPE_ACTOR) {
        actArray.splice(itemIndex,1);
        var actRow=$('#actTable').find('tr[itemIndex='+itemIndex+']');
        actRow.remove();
    }

    if(itemType=TYPE_USE_CASE) {
        ucArray.splice(itemIndex,1);
        var ucRow=$('#ucTable').find('tr[itemIndex='+itemIndex+']');
        ucRow.remove();
    }
    $('#delModal').removeData("itemIndex");
    $('#delModal').removeData("itemType");
    $("#delModal").modal('hide');

}
function submitRules()
{
    var rulesJson={
        actors : actArray,
        useCases : ucArray,
        mustHaveAssociations : mustHaveAssArray,
        mustNotHaveAssociations : mustNotHaveAssArray,
        mustHaveInclusions : mustHaveInArray,
        mustHaveExtensions : mustHaveExArray,
        mustNotHaveInclusions : mustNotHaveInArray,
        mustNotHaveExtensions : mustNotHaveExArray
    }

    var rulesJsonStr=JSON.stringify(rulesJson);
    $.get("/ClubUMLSpring2013/SetRules?rulesJSON="+rulesJsonStr);
}

</script>
</body>
</html>